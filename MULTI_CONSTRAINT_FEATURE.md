# TÃ­nh NÄƒng TÃ­nh ToÃ¡n Äa Constraint

## ğŸ¯ Tá»•ng Quan

TÃ­nh nÄƒng má»›i cho phÃ©p tÃ­nh toÃ¡n giá»›i háº¡n liá»u cho **Táº¤T Cáº¢ cÃ¡c constraints** cá»§a má»™t cÆ¡ quan, thay vÃ¬ chá»‰ tÃ­nh cho má»™t constraint duy nháº¥t.

## âœ¨ Cáº£i Tiáº¿n

### TrÆ°á»›c Ä‘Ã¢y:
```
PhÃ¡c Ä‘á»“ má»›i (3.0 Gy/fx):
60.0 Gy / 20 phÃ¢n liá»u
BED: 120.00 Gy
```

### BÃ¢y giá»:
```
PhÃ¡c Ä‘á»“ má»›i (3.0 Gy/fx):

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Constraint  â”‚ PhÃ¡c Ä‘á»“ chuáº©n    â”‚ PhÃ¡c Ä‘á»“ má»›i      â”‚ BED      â”‚ Status â”‚
â”‚             â”‚ (2 Gy/fx)        â”‚ (3.0 Gy/fx)      â”‚ Margin   â”‚        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ V15%        â”‚ 75.0 Gy / 37 fx  â”‚ 60.0 Gy / 20 fx  â”‚ +4.0%    â”‚   âœ…   â”‚
â”‚             â”‚ BED: 125.0 Gy    â”‚ BED: 120.0 Gy    â”‚          â”‚        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ V25%        â”‚ 70.0 Gy / 35 fx  â”‚ 56.0 Gy / 19 fx  â”‚ +4.0%    â”‚   âœ…   â”‚
â”‚             â”‚ BED: 116.7 Gy    â”‚ BED: 112.0 Gy    â”‚          â”‚        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ V35%        â”‚ 65.0 Gy / 32 fx  â”‚ 52.0 Gy / 17 fx  â”‚ +4.0%    â”‚   âœ…   â”‚
â”‚             â”‚ BED: 108.3 Gy    â”‚ BED: 104.0 Gy    â”‚          â”‚        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ V50%        â”‚ 60.0 Gy / 30 fx  â”‚ 48.0 Gy / 16 fx  â”‚ +4.0%    â”‚   âœ…   â”‚
â”‚             â”‚ BED: 100.0 Gy    â”‚ BED: 96.0 Gy     â”‚          â”‚        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ“Š VÃ­ Dá»¥ Cá»¥ Thá»ƒ

### VÃ­ dá»¥ 1: Rectum vá»›i 3 Gy/fx

**Input:**
- CÆ¡ quan: Rectum (Trá»±c trÃ ng)
- PhÃ¡c Ä‘á»“ má»›i: 3.0 Gy/fx
- Î±/Î²: 3 Gy

**Conventional Constraints:**
- V15% â‰¤ 75 Gy
- V25% â‰¤ 70 Gy
- V35% â‰¤ 65 Gy
- V50% â‰¤ 60 Gy

**Output:**

| Constraint | Chuáº©n (2 Gy/fx) | Má»›i (3 Gy/fx) | BED Margin | Status |
|------------|-----------------|---------------|------------|--------|
| V15% | 75.0 Gy (37 fx)<br>BED: 125.0 Gy | 60.0 Gy (20 fx)<br>BED: 120.0 Gy | +4.0% | âœ… |
| V25% | 70.0 Gy (35 fx)<br>BED: 116.7 Gy | 56.0 Gy (19 fx)<br>BED: 112.0 Gy | +4.0% | âœ… |
| V35% | 65.0 Gy (32 fx)<br>BED: 108.3 Gy | 52.0 Gy (17 fx)<br>BED: 104.0 Gy | +4.0% | âœ… |
| V50% | 60.0 Gy (30 fx)<br>BED: 100.0 Gy | 48.0 Gy (16 fx)<br>BED: 96.0 Gy | +4.0% | âœ… |

**Káº¿t luáº­n:** âœ… Táº¥t cáº£ constraints Ä‘á»u an toÃ n

### VÃ­ dá»¥ 2: Bladder vá»›i 4 Gy/fx

**Input:**
- CÆ¡ quan: Bladder (BÃ ng quang)
- PhÃ¡c Ä‘á»“ má»›i: 4.0 Gy/fx
- Î±/Î²: 3 Gy

**Conventional Constraints:**
- V15% â‰¤ 80 Gy
- V25% â‰¤ 75 Gy
- V35% â‰¤ 70 Gy
- V50% â‰¤ 65 Gy

**Output:**

| Constraint | Chuáº©n (2 Gy/fx) | Má»›i (4 Gy/fx) | BED Margin | Status |
|------------|-----------------|---------------|------------|--------|
| V15% | 80.0 Gy (40 fx)<br>BED: 133.3 Gy | 60.0 Gy (15 fx)<br>BED: 140.0 Gy | -5.0% | âŒ |
| V25% | 75.0 Gy (37 fx)<br>BED: 125.0 Gy | 56.0 Gy (14 fx)<br>BED: 130.7 Gy | -4.5% | âŒ |
| V35% | 70.0 Gy (35 fx)<br>BED: 116.7 Gy | 52.0 Gy (13 fx)<br>BED: 121.3 Gy | -4.0% | âŒ |
| V50% | 65.0 Gy (32 fx)<br>BED: 108.3 Gy | 48.0 Gy (12 fx)<br>BED: 112.0 Gy | -3.4% | âŒ |

**Káº¿t luáº­n:** âŒ Táº¤T Cáº¢ constraints Ä‘á»u vÆ°á»£t quÃ¡ giá»›i háº¡n!

## ğŸ”§ CÃ¡ch Sá»­ Dá»¥ng

### Trong á»¨ng Dá»¥ng ChÃ­nh

1. Má»Ÿ tab **"Organ Dose Limits"**
2. Chá»n cÆ¡ quan (vÃ­ dá»¥: Rectum)
3. Xem báº£ng constraints conventional
4. Nháº­p **Liá»u má»—i phÃ¢n liá»u má»›i** (vÃ­ dá»¥: 3.0 Gy)
5. Click **"TÃ­nh toÃ¡n"**
6. Xem káº¿t quáº£ cho **Táº¤T Cáº¢ constraints**

### Test RiÃªng

Má»Ÿ file `test-multi-constraint-calculation.html` trong trÃ¬nh duyá»‡t:

```bash
# Má»Ÿ trong trÃ¬nh duyá»‡t
open frontend/test-multi-constraint-calculation.html

# Hoáº·c dÃ¹ng Python HTTP server
cd frontend
python -m http.server 8080
# Truy cáº­p: http://localhost:8080/test-multi-constraint-calculation.html
```

## ğŸ“ CÃ´ng Thá»©c TÃ­nh ToÃ¡n

### Cho má»—i constraint:

1. **TÃ­nh BED chuáº©n:**
   ```
   BED_ref = D_ref Ã— (1 + d_ref/(Î±/Î²))
   ```
   Vá»›i:
   - D_ref = Dose limit tá»« constraint (vÃ­ dá»¥: 75 Gy)
   - d_ref = 2 Gy (conventional)
   - Î±/Î² = Alpha/beta ratio cá»§a cÆ¡ quan

2. **TÃ­nh liá»u tÆ°Æ¡ng Ä‘Æ°Æ¡ng:**
   ```
   D_new = BED_ref / (1 + d_new/(Î±/Î²))
   ```
   Vá»›i:
   - d_new = Dose per fraction má»›i (vÃ­ dá»¥: 3 Gy)

3. **TÃ­nh sá»‘ phÃ¢n liá»u:**
   ```
   n_new = floor(D_new / d_new)
   ```

4. **TÃ­nh liá»u thá»±c táº¿:**
   ```
   D_practical = n_new Ã— d_new
   ```

5. **TÃ­nh BED má»›i:**
   ```
   BED_new = D_practical Ã— (1 + d_new/(Î±/Î²))
   ```

6. **TÃ­nh Safety Margin:**
   ```
   Margin = ((BED_ref - BED_new) / BED_ref) Ã— 100%
   ```

## ğŸ¨ Hiá»ƒn Thá»‹ Káº¿t Quáº£

### MÃ u sáº¯c:
- âœ… **Xanh lÃ¡** (background tráº¯ng): BED má»›i â‰¤ BED chuáº©n (an toÃ n)
- âŒ **Äá»** (background há»“ng nháº¡t): BED má»›i > BED chuáº©n (vÆ°á»£t quÃ¡)

### ThÃ´ng tin hiá»ƒn thá»‹ cho má»—i constraint:
1. **TÃªn constraint** (V15%, V25%, Dmax, etc.)
2. **PhÃ¡c Ä‘á»“ chuáº©n:**
   - Total dose (Gy)
   - Sá»‘ fractions
   - BED (Gy)
3. **PhÃ¡c Ä‘á»“ má»›i:**
   - Total dose (Gy)
   - Sá»‘ fractions
   - BED (Gy)
4. **BED Margin** (%)
5. **Status** (âœ… hoáº·c âŒ)

## ğŸ” CÃ¡c Loáº¡i Constraint ÄÆ°á»£c Há»— Trá»£

1. **Dmax** - Dose tá»‘i Ä‘a
2. **Dmean** - Dose trung bÃ¬nh
3. **VX%** - Volume percent (vÃ­ dá»¥: V15%, V25%)
4. **DXcc** - Dose at volume (vÃ­ dá»¥: D15cc, D20cc)
5. **Volume to spare** - Volume cáº§n báº£o vá»‡

## âš ï¸ LÆ°u Ã Quan Trá»ng

1. **Táº¥t cáº£ constraints Ä‘á»u Ä‘Æ°á»£c tÃ­nh:**
   - KhÃ´ng chá»‰ constraint Ä‘áº§u tiÃªn
   - Má»—i constraint cÃ³ giá»›i háº¡n riÃªng

2. **Status tá»•ng thá»ƒ:**
   - âœ… Náº¿u Táº¤T Cáº¢ constraints Ä‘á»u an toÃ n
   - âŒ Náº¿u CÃ“ ÃT NHáº¤T Má»˜T constraint vÆ°á»£t quÃ¡

3. **Safety Margin:**
   - DÆ°Æ¡ng (+): An toÃ n, BED má»›i < BED chuáº©n
   - Ã‚m (-): VÆ°á»£t quÃ¡, BED má»›i > BED chuáº©n
   - CÃ ng cao cÃ ng an toÃ n

4. **LÃ m trÃ²n fractions:**
   - Sá»‘ fractions luÃ´n lÃ  sá»‘ nguyÃªn
   - LÃ m trÃ²n xuá»‘ng Ä‘á»ƒ Ä‘áº£m báº£o an toÃ n

## ğŸ“š VÃ­ Dá»¥ Thá»±c Táº¿

### Case 1: Prostate Cancer - Rectum Constraint

**TÃ¬nh huá»‘ng:**
- Bá»‡nh nhÃ¢n ung thÆ° tuyáº¿n tiá»n liá»‡t
- Muá»‘n dÃ¹ng hypofractionation: 3 Gy/fx
- Cáº§n kiá»ƒm tra rectum constraints

**Káº¿t quáº£:**
```
Rectum (Î±/Î² = 3 Gy):
âœ… V15%: 60.0 Gy (20 fx) - Margin: +4.0%
âœ… V25%: 56.0 Gy (19 fx) - Margin: +4.0%
âœ… V35%: 52.0 Gy (17 fx) - Margin: +4.0%
âœ… V50%: 48.0 Gy (16 fx) - Margin: +4.0%

â†’ Káº¿t luáº­n: An toÃ n, cÃ³ thá»ƒ dÃ¹ng 3 Gy/fx
```

### Case 2: Lung SBRT - Heart Constraint

**TÃ¬nh huá»‘ng:**
- SBRT phá»•i
- Muá»‘n dÃ¹ng 12 Gy/fx Ã— 5 fractions
- Cáº§n kiá»ƒm tra heart constraints

**Káº¿t quáº£:**
```
Heart (Î±/Î² = 3 Gy):
âŒ V33%: VÆ°á»£t quÃ¡ +15%
âŒ V67%: VÆ°á»£t quÃ¡ +20%
âœ… V100%: An toÃ n -2%

â†’ Káº¿t luáº­n: Cáº§n giáº£m liá»u hoáº·c tá»‘i Æ°u káº¿ hoáº¡ch
```

## ğŸš€ Cáº£i Tiáº¿n Trong TÆ°Æ¡ng Lai

1. **Export káº¿t quáº£** sang PDF/Excel
2. **Biá»ƒu Ä‘á»“ trá»±c quan** so sÃ¡nh BED
3. **Äá» xuáº¥t tá»± Ä‘á»™ng** liá»u tá»‘i Æ°u
4. **LÆ°u lá»‹ch sá»­** tÃ­nh toÃ¡n
5. **So sÃ¡nh nhiá»u phÃ¡c Ä‘á»“** cÃ¹ng lÃºc

## ğŸ“ Há»— Trá»£

Náº¿u cÃ³ váº¥n Ä‘á»:
1. Kiá»ƒm tra console log (F12)
2. Xem file `test-multi-constraint-calculation.html`
3. Äá»c `HUONG_DAN_SU_DUNG.md`

---

**PhiÃªn báº£n**: 2.1  
**NgÃ y cáº­p nháº­t**: November 30, 2025  
**TÃ¡c giáº£**: EQD2/BED Calculator Team
