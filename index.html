<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EQD2 & BED Calculator - T√≠nh to√°n X·∫° tr·ªã</title>
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <div class="container">
        <header>
            <h1>üè• EQD2 & BED Calculator</h1>
            <p>C√¥ng c·ª• t√≠nh to√°n li·ªÅu sinh h·ªçc trong x·∫° tr·ªã</p>
            <p class="author">Ph√°t tri·ªÉn b·ªüi <strong>Dr. Q.T. Ph·∫°m</strong></p>
            <p style="font-size: 0.9rem; color: #666; margin-top: 5px;">
                üìß <a href="mailto:qtphamhus@gmail.com" style="color: white; text-decoration: none;">qtphamhus@gmail.com</a>
            </p>
        </header>

        <main>
            <!-- Calculation Form -->
            <section class="card">
                <h2>T√≠nh to√°n BED & EQD2</h2>
                
                <form id="calculationForm">
                    <div class="form-group">
                        <label for="totalDose">T·ªïng li·ªÅu (D) - Gy:</label>
                        <input type="number" id="totalDose" step="0.1" min="0" placeholder="60.0">
                    </div>

                    <div class="form-group">
                        <label for="numFractions">S·ªë ph√¢n li·ªÅu (n):</label>
                        <input type="number" id="numFractions" min="1" placeholder="30" required>
                    </div>

                    <div class="form-group">
                        <label for="dosePerFraction">Li·ªÅu/ph√¢n li·ªÅu (d) - Gy:</label>
                        <input type="number" id="dosePerFraction" step="0.1" min="0" placeholder="2.0">
                        <small>ƒê·ªÉ tr·ªëng n·∫øu ƒë√£ nh·∫≠p t·ªïng li·ªÅu</small>
                    </div>

                    <div class="form-group">
                        <label for="alphaBetaPreset">Ch·ªçn Œ±/Œ≤ preset:</label>
                        <select id="alphaBetaPreset">
                            <option value="">-- Ch·ªçn lo·∫°i m√¥ / u --</option>
                            <optgroup label="üéØ TUMOR (U)">
                                <option value="1.5">U tuy·∫øn ti·ªÅn li·ªát (Prostate) - 1.5 Gy</option>
                                <option value="3.5">U v√∫ (Breast) - 3.5 Gy (3-4)</option>
                                <option value="10">U ƒë·∫ßu c·ªï (Head & Neck) - 10 Gy</option>
                                <option value="12">U ph·ªïi NSCLC - 12 Gy (10-15)</option>
                            </optgroup>
                            <optgroup label="üß† H·ªÜ TH·∫¶N KINH (Late Effects)">
                                <option value="2">T·ªßy s·ªëng (Spinal Cord) - 2 Gy</option>
                                <option value="2.5">N√£o (Brain Necrosis) - 2.5 Gy (2-3)</option>
                                <option value="2.5">D√¢y TK th·ªã gi√°c (Optic Nerve) - 2.5 Gy (2-3)</option>
                                <option value="1">Th·ªßy tinh th·ªÉ (Lens) - 1 Gy (0.7-1)</option>
                            </optgroup>
                            <optgroup label="‚ù§Ô∏è TIM PH·ªîI TH·∫¨N GAN">
                                <option value="3">Tim (Heart) - 3 Gy (1-3)</option>
                                <option value="3">Ph·ªïi (Lung) - 3 Gy (2-4)</option>
                                <option value="2.5">Th·∫≠n (Kidney) - 2.5 Gy (2-3)</option>
                                <option value="2.5">Gan (Liver) - 2.5 Gy (2-3)</option>
                            </optgroup>
                            <optgroup label="üîª TI·ªÇU KHUNG">
                                <option value="3">Tr·ª±c tr√†ng (Rectum) - 3 Gy</option>
                                <option value="3">B√†ng quang (Bladder) - 3 Gy</option>
                            </optgroup>
                            <optgroup label="ü©π DA X∆Ø∆†NG T·ª¶Y">
                                <option value="10">Da (Skin Acute) - 10 Gy</option>
                                <option value="3">Da (Skin Late) - 3 Gy</option>
                                <option value="3">X∆∞∆°ng (Bone) - 3 Gy</option>
                                <option value="10">T·ªßy x∆∞∆°ng (Bone Marrow) - 10 Gy</option>
                            </optgroup>
                        </select>
                        <small style="color: #666; font-size: 0.85rem; margin-top: 5px; display: block;">
                            üí° Gi√° tr·ªã d·ª±a tr√™n QUANTEC, PENTEC v√† c√°c nghi√™n c·ª©u l√¢m s√†ng
                        </small>
                    </div>

                    <div class="form-group">
                        <label for="alphaBeta">Ho·∫∑c nh·∫≠p Œ±/Œ≤ t√πy ch·ªânh - Gy:</label>
                        <input type="number" id="alphaBeta" step="0.1" min="0.1" placeholder="10.0" required>
                        <small style="color: #888;">Nh·∫≠p gi√° tr·ªã t√πy ch·ªânh n·∫øu kh√¥ng c√≥ trong danh s√°ch</small>
                    </div>

                    <div class="button-group">
                        <button type="button" class="btn btn-primary" onclick="calculateBoth()">
                            T√≠nh c·∫£ BED & EQD2
                        </button>
                        <button type="button" class="btn btn-secondary" onclick="calculateBED()">
                            Ch·ªâ t√≠nh BED
                        </button>
                        <button type="button" class="btn btn-secondary" onclick="calculateEQD2()">
                            Ch·ªâ t√≠nh EQD2
                        </button>
                    </div>
                </form>
            </section>

            <!-- Results Display -->
            <section class="card" id="resultsSection" style="display: none;">
                <h2>K·∫øt qu·∫£</h2>
                <div id="results" class="results-grid"></div>
            </section>

            <!-- Reverse Calculation -->
            <section class="card">
                <h2>T√≠nh ng∆∞·ª£c t·ª´ EQD2 m·ª•c ti√™u</h2>
                
                <form id="reverseForm">
                    <div class="form-group">
                        <label for="targetEQD2">EQD2 m·ª•c ti√™u - Gy:</label>
                        <input type="number" id="targetEQD2" step="0.1" min="0" placeholder="60.0" required>
                    </div>

                    <div class="form-group">
                        <label for="reverseDosePerFraction">Li·ªÅu/ph√¢n li·ªÅu (d) - Gy:</label>
                        <input type="number" id="reverseDosePerFraction" step="0.1" min="0" placeholder="2.0" required>
                    </div>

                    <div class="form-group">
                        <label for="reverseAlphaBetaPreset">Ch·ªçn Œ±/Œ≤ preset:</label>
                        <select id="reverseAlphaBetaPreset">
                            <option value="">-- Ch·ªçn lo·∫°i m√¥ / u --</option>
                            <optgroup label="üéØ TUMOR (U)">
                                <option value="1.5">U tuy·∫øn ti·ªÅn li·ªát (Prostate) - 1.5 Gy</option>
                                <option value="3.5">U v√∫ (Breast) - 3.5 Gy (3-4)</option>
                                <option value="10">U ƒë·∫ßu c·ªï (Head & Neck) - 10 Gy</option>
                                <option value="12">U ph·ªïi NSCLC - 12 Gy (10-15)</option>
                            </optgroup>
                            <optgroup label="üß† H·ªÜ TH·∫¶N KINH (Late Effects)">
                                <option value="2">T·ªßy s·ªëng (Spinal Cord) - 2 Gy</option>
                                <option value="2.5">N√£o (Brain Necrosis) - 2.5 Gy (2-3)</option>
                                <option value="2.5">D√¢y TK th·ªã gi√°c (Optic Nerve) - 2.5 Gy (2-3)</option>
                                <option value="1">Th·ªßy tinh th·ªÉ (Lens) - 1 Gy (0.7-1)</option>
                            </optgroup>
                            <optgroup label="‚ù§Ô∏è TIM PH·ªîI TH·∫¨N GAN">
                                <option value="3">Tim (Heart) - 3 Gy (1-3)</option>
                                <option value="3">Ph·ªïi (Lung) - 3 Gy (2-4)</option>
                                <option value="2.5">Th·∫≠n (Kidney) - 2.5 Gy (2-3)</option>
                                <option value="2.5">Gan (Liver) - 2.5 Gy (2-3)</option>
                            </optgroup>
                            <optgroup label="üîª TI·ªÇU KHUNG">
                                <option value="3">Tr·ª±c tr√†ng (Rectum) - 3 Gy</option>
                                <option value="3">B√†ng quang (Bladder) - 3 Gy</option>
                            </optgroup>
                            <optgroup label="ü©π DA X∆Ø∆†NG T·ª¶Y">
                                <option value="10">Da (Skin Acute) - 10 Gy</option>
                                <option value="3">Da (Skin Late) - 3 Gy</option>
                                <option value="3">X∆∞∆°ng (Bone) - 3 Gy</option>
                                <option value="10">T·ªßy x∆∞∆°ng (Bone Marrow) - 10 Gy</option>
                            </optgroup>
                        </select>
                        <small style="color: #666; font-size: 0.85rem; margin-top: 5px; display: block;">
                            üí° Gi√° tr·ªã d·ª±a tr√™n QUANTEC, PENTEC v√† c√°c nghi√™n c·ª©u l√¢m s√†ng
                        </small>
                    </div>

                    <div class="form-group">
                        <label for="reverseAlphaBeta">Ho·∫∑c nh·∫≠p Œ±/Œ≤ t√πy ch·ªânh - Gy:</label>
                        <input type="number" id="reverseAlphaBeta" step="0.1" min="0.1" placeholder="10.0" required>
                        <small style="color: #888;">Nh·∫≠p gi√° tr·ªã t√πy ch·ªânh n·∫øu kh√¥ng c√≥ trong danh s√°ch</small>
                    </div>

                    <button type="button" class="btn btn-primary" onclick="calculateReverse()">
                        T√≠nh s·ªë ph√¢n li·ªÅu c·∫ßn thi·∫øt
                    </button>
                </form>

                <div id="reverseResults" style="display: none; margin-top: 20px;"></div>
            </section>

            <!-- Treatment Gap Compensation Calculator -->
            <section class="card">
                <h2>‚è∏Ô∏è T√≠nh b√π li·ªÅu khi gi√°n ƒëo·∫°n x·∫° tr·ªã</h2>
                <p style="color: #666; margin-bottom: 20px;">
                    T√≠nh to√°n li·ªÅu b√π khi c√≥ gi√°n ƒëo·∫°n trong qu√° tr√¨nh x·∫° tr·ªã (do t√°i sinh t·∫ø b√†o u)
                </p>
                
                <form id="gapCompensationForm">
                    <div class="form-group">
                        <label for="tumorType">Lo·∫°i u:</label>
                        <select id="tumorType">
                            <option value="">-- Ch·ªçn lo·∫°i u --</option>
                            <optgroup label="üéØ U bi·ªÉu m√¥ (nhanh)">
                                <option value="hnscc">U ƒë·∫ßu c·ªï (HNSCC) - 0.7 Gy/day</option>
                                <option value="nsclc">U ph·ªïi NSCLC - 0.6 Gy/day</option>
                                <option value="sclc">U ph·ªïi SCLC - 0.75 Gy/day</option>
                                <option value="esophagus">U th·ª±c qu·∫£n - 0.6 Gy/day</option>
                                <option value="cervix">U c·ªï t·ª≠ cung - 0.6 Gy/day</option>
                                <option value="bladder">U b√†ng quang - 0.6 Gy/day</option>
                                <option value="rectum">U tr·ª±c tr√†ng - 0.6 Gy/day</option>
                            </optgroup>
                            <optgroup label="üß† U n√£o">
                                <option value="gbm">GBM (Glioblastoma) - 0.5 Gy/day</option>
                            </optgroup>
                            <optgroup label="ü©∏ U lympho">
                                <option value="lymphoma">Lymphoma - 1.0 Gy/day (r·∫•t nhanh)</option>
                            </optgroup>
                            <optgroup label="üêå U ch·∫≠m">
                                <option value="breast">U v√∫ (Breast) - 0.15 Gy/day</option>
                                <option value="prostate">U tuy·∫øn ti·ªÅn li·ªát - ‚âà0 Gy/day</option>
                            </optgroup>
                            <optgroup label="‚öôÔ∏è T√πy ch·ªânh">
                                <option value="custom">Nh·∫≠p th·ªß c√¥ng</option>
                            </optgroup>
                        </select>
                        <small style="color: #666; font-size: 0.85rem; margin-top: 5px; display: block;">
                            üí° D·ª±a tr√™n QUANTEC, PENTEC v√† c√°c nghi√™n c·ª©u l√¢m s√†ng
                        </small>
                    </div>

                    <div class="form-group">
                        <label for="repopulationRate">T·ªëc ƒë·ªô t√°i sinh (Gy/ng√†y):</label>
                        <input type="number" id="repopulationRate" step="0.1" min="0" placeholder="0.6" required>
                        <small>Th√¥ng th∆∞·ªùng: U ƒë·∫ßu c·ªï 0.6-0.7, U ph·ªïi 0.5, U kh√°c 0.3-0.5 Gy/ng√†y</small>
                    </div>

                    <div class="form-group">
                        <label for="gapDays">S·ªë ng√†y gi√°n ƒëo·∫°n:</label>
                        <input type="number" id="gapDays" min="1" placeholder="7" required>
                        <small>S·ªë ng√†y kh√¥ng x·∫° tr·ªã (kh√¥ng t√≠nh cu·ªëi tu·∫ßn th√¥ng th∆∞·ªùng)</small>
                    </div>

                    <div class="form-group">
                        <label for="originalTotalDose">T·ªïng li·ªÅu ban ƒë·∫ßu (Gy):</label>
                        <input type="number" id="originalTotalDose" step="0.1" min="0" placeholder="70.0" required>
                    </div>

                    <div class="form-group">
                        <label for="originalFractions">S·ªë ph√¢n li·ªÅu ban ƒë·∫ßu:</label>
                        <input type="number" id="originalFractions" min="1" placeholder="35" required>
                    </div>

                    <div class="form-group">
                        <label for="completedFractions">S·ªë ph√¢n li·ªÅu ƒë√£ ho√†n th√†nh:</label>
                        <input type="number" id="completedFractions" min="0" placeholder="20" required>
                        <small>S·ªë ph√¢n li·ªÅu ƒë√£ x·∫° tr∆∞·ªõc khi gi√°n ƒëo·∫°n</small>
                    </div>

                    <div class="form-group">
                        <label for="gapAlphaBeta">Œ±/Œ≤ c·ªßa u (Gy):</label>
                        <input type="number" id="gapAlphaBeta" step="0.1" min="0.1" placeholder="10.0" value="10.0">
                        <small>Gi√° tr·ªã Œ±/Œ≤ cho t√≠nh to√°n BED (m·∫∑c ƒë·ªãnh: 10 Gy cho u)</small>
                    </div>

                    <div class="form-group">
                        <label for="compensationMethod">Ph∆∞∆°ng ph√°p b√π li·ªÅu:</label>
                        <select id="compensationMethod">
                            <option value="simple">ƒê∆°n gi·∫£n (2 ph∆∞∆°ng √°n c∆° b·∫£n)</option>
                            <option value="all">ƒê·∫ßy ƒë·ªß (6 ph∆∞∆°ng ph√°p khoa h·ªçc)</option>
                        </select>
                        <small style="color: #666; font-size: 0.85rem; margin-top: 5px; display: block;">
                            üí° Ch·∫ø ƒë·ªô "ƒê·∫ßy ƒë·ªß" bao g·ªìm: BID, Extra fractions, 6 days/week, Increase dose, Hybrid
                        </small>
                    </div>

                    <!-- Advanced parameters (hidden by default) -->
                    <div id="advancedGapParams" style="display: none;">
                        <h4 style="color: #667eea; margin-top: 20px;">‚öôÔ∏è Th√¥ng s·ªë n√¢ng cao (t√πy ch·ªçn)</h4>
                        
                        <div class="form-group">
                            <label for="ottMax">OTT t·ªëi ƒëa cho ph√©p (ng√†y):</label>
                            <input type="number" id="ottMax" min="1" placeholder="56" value="56">
                            <small>Overall Treatment Time t·ªëi ƒëa (m·∫∑c ƒë·ªãnh: 56 ng√†y cho u ƒë·∫ßu c·ªï)</small>
                        </div>

                        <div class="form-group">
                            <label for="ottCompleted">OTT ƒë√£ ho√†n th√†nh (ng√†y):</label>
                            <input type="number" id="ottCompleted" min="0" placeholder="28">
                            <small>S·ªë ng√†y ƒëi·ªÅu tr·ªã ƒë√£ th·ª±c hi·ªán (t√≠nh c·∫£ cu·ªëi tu·∫ßn)</small>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="tumorDoublingTime">Tumor Doubling Time (Td) - ng√†y:</label>
                        <input type="number" id="tumorDoublingTime" step="0.1" min="0.1" placeholder="3.0" value="3.0">
                        <small>Th·ªùi gian tƒÉng g·∫•p ƒë√¥i th·ªÉ t√≠ch kh·ªëi u (m·∫∑c ƒë·ªãnh: 3 ng√†y cho u nhanh)</small>
                    </div>

                    <div class="button-group">
                        <button type="button" class="btn btn-primary" onclick="window.gapCompensationUI.calculateAllMethods()">
                            üßÆ T√≠nh to√°n t·∫•t c·∫£ ph∆∞∆°ng ph√°p
                        </button>
                        <button type="button" class="btn btn-secondary" onclick="calculateGapCompensation()">
                            üìä Ph∆∞∆°ng ph√°p ƒë∆°n gi·∫£n (c≈©)
                        </button>
                        <button type="button" class="btn btn-secondary" onclick="toggleAdvancedGapParams()">
                            ‚öôÔ∏è Th√¥ng s·ªë n√¢ng cao
                        </button>
                    </div>
                </form>

                <div id="gapCompensationResults" style="display: none; margin-top: 20px;"></div>
            </section>

            <!-- Organ Dose Limit Lookup & Calculator -->
            <section class="card">
                <h2>üìö Tra c·ª©u & T√≠nh to√°n Gi·ªõi h·∫°n Li·ªÅu C∆° quan</h2>
                <p style="color: #666; margin-bottom: 20px;">
                    Tra c·ª©u gi·ªõi h·∫°n li·ªÅu chu·∫©n, SBRT v√† t√≠nh to√°n li·ªÅu m·ªõi v·ªõi ph√¢n li·ªÅu kh√°c
                </p>
                
                <form id="organDoseLookupForm">
                    <div class="form-group">
                        <label for="organLookupSelector">Ch·ªçn c∆° quan:</label>
                        <select id="organLookupSelector">
                            <option value="">-- Ch·ªçn c∆° quan ƒë·ªÉ tra c·ª©u --</option>
                        </select>
                        <small style="color: #666; font-size: 0.85rem; margin-top: 5px; display: block;">
                            üí° Database 30+ c∆° quan t·ª´ RTOG, QUANTEC, AAPM TG-101
                        </small>
                    </div>

                    <button type="button" class="btn btn-primary" onclick="lookupOrganDose()">
                        üîç Tra c·ª©u th√¥ng tin
                    </button>
                </form>

                <div id="organDoseLookupResults" style="display: none; margin-top: 20px;"></div>

                <!-- Custom Dose Calculator -->
                <div id="customDoseCalculatorSection" style="display: none; margin-top: 30px;">
                    <h3 style="color: #667eea;">üßÆ T√≠nh li·ªÅu v·ªõi ph√¢n li·ªÅu t√πy ch·ªânh</h3>
                    <div class="form-group">
                        <label for="customDosePerFraction">Li·ªÅu/ph√¢n li·ªÅu m·ªõi (Gy):</label>
                        <input type="number" id="customDosePerFraction" step="0.1" min="0.1" placeholder="3.0">
                        <small>Nh·∫≠p li·ªÅu/ph√¢n li·ªÅu kh√°c v·ªõi chu·∫©n (2 Gy)</small>
                    </div>
                    <button type="button" class="btn btn-secondary" onclick="calculateCustomOrganDose()">
                        üßÆ T√≠nh li·ªÅu gi·ªõi h·∫°n m·ªõi
                    </button>
                    <div id="customOrganDoseResults" style="display: none; margin-top: 15px;"></div>
                </div>
            </section>

            <!-- History -->
            <section class="card">
                <h2>L·ªãch s·ª≠ t√≠nh to√°n</h2>
                <div class="button-group">
                    <button class="btn btn-secondary" onclick="loadHistory()">
                        üîÑ T·∫£i l·ªãch s·ª≠
                    </button>
                    <button class="btn btn-secondary" onclick="exportHistory()">
                        üì• Xu·∫•t file
                    </button>
                </div>
                <div id="historyList" style="margin-top: 20px;"></div>
            </section>
        </main>

        <footer>
            <p>¬© 2025 EQD2 & BED Calculator | C√¥ng c·ª• h·ªó tr·ª£ x·∫° tr·ªã</p>
            <p style="margin-top: 10px; font-size: 0.95rem;">
                Ph√°t tri·ªÉn b·ªüi <strong>Dr. Q.T. Ph·∫°m</strong> üë®‚Äç‚öïÔ∏è
            </p>
            <p style="margin-top: 10px; font-size: 0.9rem;">
                üìß Li√™n h·ªá: <a href="mailto:qtphamhus@gmail.com" style="color: white; text-decoration: none;">qtphamhus@gmail.com</a>
            </p>
        </footer>
    </div>

    <!-- Input Normalizer - H·ªó tr·ª£ d·∫•u ph·∫©y v√† d·∫•u ch·∫•m -->
    <script src="js/input-normalizer.js"></script>
    
    <!-- Organ Dose Lookup Scripts -->
    <script src="js/organ-dose-database.js"></script>
    <script src="js/bed-calculator.js"></script>
    <script src="js/validation-engine.js"></script>
    <script src="js/organ-dose-ui.js"></script>
    
    <!-- Gap Compensation Modules (New Architecture) -->
    <script src="js/gap-compensation-core.js"></script>
    <script src="js/gap-compensation-strategies.js"></script>
    <script src="js/gap-compensation-ui.js"></script>
    
    <!-- Advanced Gap Compensation Calculator (Legacy) -->
    <script src="js/gap-compensation-advanced.js"></script>
    
    <script src="js/app.js?v=4"></script>
</body>
</html>
