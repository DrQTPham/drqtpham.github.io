<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <title>Inline Test</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; max-width: 800px; margin: 0 auto; }
        .form-group { margin: 15px 0; }
        label { display: block; margin-bottom: 5px; font-weight: bold; }
        input { padding: 8px; width: 100%; font-size: 14px; box-sizing: border-box; }
        button { padding: 12px 24px; background: #667eea; color: white; border: none; cursor: pointer; font-size: 16px; border-radius: 5px; margin-top: 10px; }
        button:hover { background: #5568d3; }
        #result { margin-top: 20px; padding: 20px; background: #f0f0f0; border-radius: 8px; display: none; }
        .alert { padding: 15px; margin: 10px 0; border-radius: 5px; }
        .alert-success { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .alert-error { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
    </style>
</head>
<body>
    <h1>üß™ Inline Test - Organ Limit Calculator</h1>
    
    <div class="form-group">
        <label>Li·ªÅu gi·ªõi h·∫°n chu·∫©n (2 Gy/fx) - Gy:</label>
        <input type="number" id="standardLimit" value="45" step="0.1" />
    </div>

    <div class="form-group">
        <label>Œ±/Œ≤ c·ªßa c∆° quan - Gy:</label>
        <input type="number" id="alphaBeta" value="2.0" step="0.1" />
    </div>

    <div class="form-group">
        <label>Li·ªÅu/ph√¢n li·ªÅu m·ªõi - Gy:</label>
        <input type="number" id="newDose" value="3.0" step="0.1" />
    </div>

    <button onclick="calculate()">üßÆ T√≠nh to√°n</button>

    <div id="result"></div>

    <script>
        function calculate() {
            console.log('Calculate function called');
            
            // Get values
            const standardLimit = parseFloat(document.getElementById('standardLimit').value);
            const alphaBeta = parseFloat(document.getElementById('alphaBeta').value);
            const newDose = parseFloat(document.getElementById('newDose').value);
            
            console.log('Input:', { standardLimit, alphaBeta, newDose });
            
            // Validate
            if (!standardLimit || !alphaBeta || !newDose) {
                alert('Vui l√≤ng nh·∫≠p ƒë·∫ßy ƒë·ªß th√¥ng tin!');
                return;
            }
            
            if (isNaN(standardLimit) || isNaN(alphaBeta) || isNaN(newDose)) {
                alert('Vui l√≤ng nh·∫≠p gi√° tr·ªã s·ªë h·ª£p l·ªá!');
                return;
            }
            
            // Calculate
            const dStandard = 2.0;
            const bedStandard = standardLimit * (1 + dStandard / alphaBeta);
            
            const newTotalDoseLimit = bedStandard / (1 + newDose / alphaBeta);
            const newNumFractions = Math.floor(newTotalDoseLimit / newDose);
            const actualTotalDose = newNumFractions * newDose;
            const actualBED = actualTotalDose * (1 + newDose / alphaBeta);
            const safetyMargin = ((bedStandard - actualBED) / bedStandard * 100);
            
            console.log('Results:', {
                bedStandard,
                newTotalDoseLimit,
                newNumFractions,
                actualTotalDose,
                actualBED,
                safetyMargin
            });
            
            // Display
            const resultDiv = document.getElementById('result');
            
            let alertClass = 'alert-success';
            let alertText = '‚úÖ Trong gi·ªõi h·∫°n an to√†n';
            
            if (actualBED > bedStandard) {
                alertClass = 'alert-error';
                alertText = '‚ö†Ô∏è C·∫¢NH B√ÅO: BED v∆∞·ª£t qu√° gi·ªõi h·∫°n!';
            } else if (safetyMargin < 5) {
                alertClass = 'alert-error';
                alertText = '‚ö†Ô∏è C·∫¢NH B√ÅO: Margin qu√° th·∫•p!';
            }
            
            resultDiv.innerHTML = `
                <div class="alert ${alertClass}">
                    <h3>${alertText}</h3>
                    <hr style="margin: 15px 0; border: none; border-top: 1px solid #ccc;">
                    <p><strong>Ph√°c ƒë·ªì chu·∫©n (2 Gy/fx):</strong> ${standardLimit.toFixed(1)} Gy</p>
                    <p><strong>BED chu·∫©n:</strong> ${bedStandard.toFixed(2)} Gy</p>
                    <hr style="margin: 15px 0; border: none; border-top: 1px solid #ccc;">
                    <p><strong>Ph√°c ƒë·ªì m·ªõi (${newDose.toFixed(1)} Gy/fx):</strong> ${actualTotalDose.toFixed(1)} Gy</p>
                    <p><strong>S·ªë ph√¢n li·ªÅu:</strong> ${newNumFractions}</p>
                    <p><strong>BED m·ªõi:</strong> ${actualBED.toFixed(2)} Gy</p>
                    <p><strong>Margin an to√†n:</strong> ${safetyMargin.toFixed(1)}%</p>
                </div>
            `;
            
            resultDiv.style.display = 'block';
            resultDiv.scrollIntoView({ behavior: 'smooth' });
            
            console.log('Result displayed successfully');
        }
        
        console.log('Inline test page loaded');
    </script>
</body>
</html>
