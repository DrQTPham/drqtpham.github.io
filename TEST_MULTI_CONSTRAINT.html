<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TEST - Multi-Constraint Display</title>
    <link rel="stylesheet" href="css/style.css">
    <style>
        .test-info {
            background: #fff3cd;
            border-left: 4px solid #ffc107;
            padding: 20px;
            margin-bottom: 30px;
            border-radius: 8px;
        }
        .test-info h2 {
            color: #856404;
            margin-top: 0;
        }
        .test-info ul {
            color: #856404;
            line-height: 1.8;
        }
        .expected-result {
            background: #d4edda;
            border-left: 4px solid #28a745;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
        }
        .expected-result h3 {
            color: #155724;
            margin-top: 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>üß™ TEST - Multi-Constraint Display</h1>
            <p>Ki·ªÉm tra hi·ªÉn th·ªã T·∫§T C·∫¢ constraints</p>
        </header>

        <main>
            <div class="test-info">
                <h2>üìã H∆∞·ªõng d·∫´n Test</h2>
                <ol>
                    <li>Ch·ªçn c∆° quan: <strong>Rectum (Tr·ª±c tr√†ng)</strong></li>
                    <li>Click <strong>"Tra c·ª©u th√¥ng tin"</strong></li>
                    <li>Nh·∫≠p li·ªÅu m·ªõi: <strong>3.0</strong> Gy</li>
                    <li>Click <strong>"T√≠nh li·ªÅu gi·ªõi h·∫°n m·ªõi"</strong></li>
                    <li>Ki·ªÉm tra k·∫øt qu·∫£ b√™n d∆∞·ªõi</li>
                </ol>
            </div>

            <div class="expected-result">
                <h3>‚úÖ K·∫øt qu·∫£ mong ƒë·ª£i:</h3>
                <p><strong>Ph·∫£i hi·ªÉn th·ªã b·∫£ng v·ªõi 4 d√≤ng:</strong></p>
                <ul>
                    <li><strong>V15%</strong>: 75.0 Gy (37 fx) ‚Üí 60.0 Gy (20 fx) | Margin: +4.0% | ‚úÖ</li>
                    <li><strong>V25%</strong>: 70.0 Gy (35 fx) ‚Üí 56.0 Gy (19 fx) | Margin: +4.0% | ‚úÖ</li>
                    <li><strong>V35%</strong>: 65.0 Gy (32 fx) ‚Üí 52.0 Gy (17 fx) | Margin: +4.0% | ‚úÖ</li>
                    <li><strong>V50%</strong>: 60.0 Gy (30 fx) ‚Üí 48.0 Gy (16 fx) | Margin: +4.0% | ‚úÖ</li>
                </ul>
                <p style="margin-top: 15px; color: #155724;">
                    <strong>‚ùå N·∫øu ch·ªâ th·∫•y 1 d√≤ng:</strong> Cache ch∆∞a clear ho·∫∑c file ch∆∞a load ƒë√∫ng
                </p>
            </div>

            <!-- Organ Dose Lookup & Calculator -->
            <section class="card">
                <h2>üìö Tra c·ª©u & T√≠nh to√°n Gi·ªõi h·∫°n Li·ªÅu C∆° quan</h2>
                
                <form id="organDoseLookupForm">
                    <div class="form-group">
                        <label for="organLookupSelector">Ch·ªçn c∆° quan:</label>
                        <select id="organLookupSelector">
                            <option value="">-- Ch·ªçn c∆° quan ƒë·ªÉ tra c·ª©u --</option>
                        </select>
                    </div>

                    <button type="button" class="btn btn-primary" onclick="lookupOrganDose()">
                        üîç Tra c·ª©u th√¥ng tin
                    </button>
                </form>

                <div id="organDoseLookupResults" style="display: none; margin-top: 20px;"></div>

                <!-- Custom Dose Calculator -->
                <div id="customDoseCalculatorSection" style="display: none; margin-top: 30px;">
                    <h3 style="color: #667eea;">üßÆ T√≠nh li·ªÅu v·ªõi ph√¢n li·ªÅu t√πy ch·ªânh</h3>
                    <div class="form-group">
                        <label for="customDosePerFraction">Li·ªÅu/ph√¢n li·ªÅu m·ªõi (Gy):</label>
                        <input type="number" id="customDosePerFraction" step="0.1" min="0.1" placeholder="3.0" value="3.0">
                    </div>
                    <button type="button" class="btn btn-secondary" onclick="calculateCustomOrganDose()">
                        üßÆ T√≠nh li·ªÅu gi·ªõi h·∫°n m·ªõi
                    </button>
                    <div id="customOrganDoseResults" style="display: none; margin-top: 15px;"></div>
                </div>
            </section>

            <!-- Debug Info -->
            <section class="card">
                <h2>üîç Debug Info</h2>
                <div id="debugInfo" style="background: #f8f9fa; padding: 15px; border-radius: 6px; font-family: monospace; font-size: 0.9rem;">
                    <p>Loading debug info...</p>
                </div>
            </section>
        </main>

        <footer>
            <p>¬© 2025 EQD2 & BED Calculator - Test Page</p>
            <p style="margin-top: 10px; font-size: 0.9rem;">
                Ph√°t tri·ªÉn b·ªüi <strong>Dr. Q.T. Ph·∫°m</strong> üë®‚Äç‚öïÔ∏è<br>
                üìß Li√™n h·ªá: <a href="mailto:qtphamhus@gmail.com" style="color: white; text-decoration: none;">qtphamhus@gmail.com</a>
            </p>
        </footer>
    </div>

    <!-- Load Scripts -->
    <script src="js/organ-dose-database.js"></script>
    <script src="js/bed-calculator.js"></script>
    <script src="js/validation-engine.js"></script>
    <script src="js/organ-dose-ui.js"></script>
    
    <script>
        // Debug info
        window.addEventListener('load', () => {
            const debugDiv = document.getElementById('debugInfo');
            const organCount = typeof getOrganCount === 'function' ? getOrganCount() : 'N/A';
            const rectum = typeof getOrgan === 'function' ? getOrgan('rectum') : null;
            const conventionalCount = rectum && rectum.conventional ? rectum.conventional.length : 0;
            
            debugDiv.innerHTML = `
                <p><strong>‚úÖ Scripts Loaded:</strong></p>
                <p>‚Ä¢ organ-dose-database.js: ${typeof ORGAN_DATABASE !== 'undefined' ? '‚úÖ' : '‚ùå'}</p>
                <p>‚Ä¢ bed-calculator.js: ${typeof bedCalculator !== 'undefined' ? '‚úÖ' : '‚ùå'}</p>
                <p>‚Ä¢ validation-engine.js: ${typeof validationEngine !== 'undefined' ? '‚úÖ' : '‚ùå'}</p>
                <p>‚Ä¢ organ-dose-ui.js: ${typeof initializeOrganSelector === 'function' ? '‚úÖ' : '‚ùå'}</p>
                <p style="margin-top: 15px;"><strong>üìä Data Check:</strong></p>
                <p>‚Ä¢ Total organs: ${organCount}</p>
                <p>‚Ä¢ Rectum conventional constraints: ${conventionalCount}</p>
                <p style="margin-top: 15px;"><strong>üîß Functions Check:</strong></p>
                <p>‚Ä¢ formatConstraintLabel: ${typeof formatConstraintLabel === 'function' ? '‚úÖ' : '‚ùå'}</p>
                <p>‚Ä¢ calculateCustomOrganDose: ${typeof calculateCustomOrganDose === 'function' ? '‚úÖ' : '‚ùå'}</p>
                <p>‚Ä¢ displayCustomDoseResults: ${typeof displayCustomDoseResults === 'function' ? '‚úÖ' : '‚ùå'}</p>
            `;
        });

        // Auto-select rectum for quick test
        window.addEventListener('load', () => {
            setTimeout(() => {
                const selector = document.getElementById('organLookupSelector');
                if (selector && selector.options.length > 1) {
                    // Find rectum option
                    for (let i = 0; i < selector.options.length; i++) {
                        if (selector.options[i].value === 'rectum') {
                            selector.value = 'rectum';
                            console.log('‚úÖ Auto-selected Rectum');
                            break;
                        }
                    }
                }
            }, 500);
        });

        // Show alert function
        function showAlert(message, type = 'info') {
            const typeMap = {
                'error': '‚ùå',
                'warning': '‚ö†Ô∏è',
                'success': '‚úÖ',
                'info': '‚ÑπÔ∏è'
            };
            alert(`${typeMap[type]} ${message}`);
        }

        console.log('üß™ Test page loaded');
        console.log('üìù Instructions:');
        console.log('1. Select Rectum');
        console.log('2. Click "Tra c·ª©u th√¥ng tin"');
        console.log('3. Enter 3.0 Gy');
        console.log('4. Click "T√≠nh li·ªÅu gi·ªõi h·∫°n m·ªõi"');
        console.log('5. Check if you see 4 rows (V15%, V25%, V35%, V50%)');
    </script>
</body>
</html>
